<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ê°ˆë§·ê¸¸ 100M | ê²°ê³¼ì¡°íšŒ</title>
    <meta name="description" content="ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ê²°ê³¼ ì¡°íšŒ ë° ì™„ì£¼ì¦ ë°œê¸‰">
    <link rel="stylesheet" href="css/styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Nanum+Brush+Script&display=swap"
        rel="stylesheet">
    <style>
        /* Page-specific overrides for Result Page */
        .btn-green {
            background: #22c55e;
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        .btn-green:hover {
            background: #16a34a;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Adjust main content padding for fixed nav */
        main {
            padding-top: 100px;
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-desktop">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/main_logo.jpg" alt="ê°ˆë§·ê¸¸ 100M" onerror="this.src='https://via.placeholder.com/40'">
                <span>BUSAN 100M</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="course.html">ì½”ìŠ¤</a></li>
                <li><a href="schedule.html">ì¼ì •</a></li>
                <li><a href="registration.html">ì°¸ê°€ì‹ ì²­</a></li>
                <li><a href="notices.html">ê³µì§€ì‚¬í•­</a></li>
                <li><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="gallery.html">ê°¤ëŸ¬ë¦¬</a></li>
                <li><a href="results.html" class="active">ê²°ê³¼ì¡°íšŒ</a></li>
            </ul>
            <button class="nav-hamburger" onclick="toggleMenu()">â˜°</button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html">ğŸ  í™ˆ</a>
        <a href="course.html">ğŸ—ºï¸ ì½”ìŠ¤</a>
        <a href="schedule.html">ğŸ“… ì¼ì •</a>
        <a href="registration.html">ğŸ“ ì°¸ê°€ì‹ ì²­</a>
        <a href="notices.html">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
        <a href="community.html">ğŸ‘¥ ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="gallery.html">ğŸ“¸ ê°¤ëŸ¬ë¦¬</a>
        <a href="results.html">ğŸ† ê²°ê³¼ì¡°íšŒ</a>
    </div>

    <!-- Main Content -->
    <main>
        <section style="max-width:800px; margin:0 auto; padding:40px 24px;">
            <h1 style="font-size:2.5rem; text-align:center; margin-bottom:48px; color:#ef4444;">ê²°ê³¼ ì¡°íšŒ / ì™„ì£¼ì¦</h1>

            <!-- Search Form -->
            <div class="glass-card" style="padding:24px; margin-bottom:32px;">
                <h2 style="font-size:1.25rem; margin-bottom:24px; color:#fff;">ğŸ† ê¸°ë¡ ê²€ìƒ‰</h2>
                <form id="search-form" style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">
                    <div style="flex:1; min-width:150px;">
                        <label style="display:block; font-size:0.875rem; color:#94a3b8; margin-bottom:8px;">ì´ë¦„</label>
                        <input type="text" id="search-name" required class="form-input" placeholder="í™ê¸¸ë™">
                    </div>
                    <div style="width:120px;">
                        <label style="display:block; font-size:0.875rem; color:#94a3b8; margin-bottom:8px;">íœ´ëŒ€í° ë’·ìë¦¬</label>
                        <input type="text" id="search-phone" required maxlength="4" class="form-input" placeholder="0000">
                    </div>
                    <button type="submit" class="btn-primary" style="height:52px;">ê²€ìƒ‰</button>
                </form>
                <p style="font-size:0.75rem; color:#64748b; margin-top:12px;">
                    ğŸ’¡ í…ŒìŠ¤íŠ¸: ì´ë¦„ "ê¹€ì² ìˆ˜", ë’·ìë¦¬ "1234" (Mock ë°ì´í„°)
                </p>
            </div>

            <!-- Result Display -->
            <div id="result-container" style="display:none;">
                <!-- Filled by JS -->
            </div>

            <!-- Certificate Canvas (Hidden) -->
            <canvas id="certificate-canvas" style="display:none;"></canvas>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div style="font-weight:700; color:#fff; margin-bottom:8px;">ë¶€ì‚° ê°ˆë§·ê¸¸ 100M</div>
        <div style="font-size:0.875rem;">Â© 2026 Busan Galmaetgil 100M. All rights reserved.</div>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <a href="index.html"><span class="icon">ğŸ </span>í™ˆ</a>
            <a href="course.html"><span class="icon">ğŸ—ºï¸</span>ì½”ìŠ¤</a>
            <a href="schedule.html"><span class="icon">ğŸ“…</span>ì¼ì •</a>
            <a href="registration.html"><span class="icon">ğŸ“</span>ì‹ ì²­</a>
            <a href="results.html" class="active"><span class="icon">ğŸ†</span>ê²°ê³¼</a>
        </div>
    </nav>

    <!-- SOS Button -->
    <button class="location-share-btn">â—</button>

    <script src="js/app.js"></script>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('mobileMenu');
            const btn = document.querySelector('.nav-hamburger');
            menu.classList.toggle('open');
            btn.textContent = menu.classList.contains('open') ? 'âœ•' : 'â˜°';
        }

        let currentResult = null;

        document.getElementById('search-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('search-name').value;
            const phone4 = document.getElementById('search-phone').value;
            const container = document.getElementById('result-container');

            container.style.display = 'block';
            container.innerHTML = '<p style="text-align:center; color:#94a3b8;">ê²€ìƒ‰ ì¤‘...</p>';

            const result = await searchResult(name, phone4);
            currentResult = result;

            if (result) {
                container.innerHTML = `
                    <div class="glass-card fade-in" style="padding:32px; text-align:center;">
                        <div style="font-size:4rem; margin-bottom:16px;">ğŸ‰</div>
                        <h2 style="font-size:1.75rem; margin-bottom:8px; color:#fff;">${result.name}ë‹˜ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
                        <p style="color:#94a3b8; margin-bottom:24px;">
                            ${result.course} ì™„ì£¼ | ê¸°ë¡ ${result.time} | ${result.rank}ìœ„
                        </p>

                        <div id="certificate-preview" style="margin-bottom:24px;">
                            <!-- Certificate will be rendered here -->
                        </div>

                        <button onclick="downloadCertificate()" class="btn-primary btn-green" style="width:100%; font-size:1.1rem;">
                            ğŸ“¥ ì™„ì£¼ì¦ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                `;
                generateCertificate();
            } else {
                container.innerHTML = `
                    <div class="glass-card fade-in" style="padding:32px; text-align:center;">
                        <div style="font-size:4rem; margin-bottom:16px;">ğŸ˜¢</div>
                        <h2 style="font-size:1.25rem; margin-bottom:8px; color:#fff;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p style="color:#94a3b8;">ì´ë¦„ê³¼ íœ´ëŒ€í° ë’·ìë¦¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        });

        function generateCertificate() {
            if (!currentResult) return;

            const canvas = document.getElementById('certificate-canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            // Default fallback drawing
            const drawFallback = () => {
                canvas.width = 1200;
                canvas.height = 850;

                // Background gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#f8fafc');
                gradient.addColorStop(1, '#e2e8f0');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Border
                ctx.strokeStyle = '#0f172a';
                ctx.lineWidth = 10;
                ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

                // Inner Border
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 2;
                ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);

                // Title
                ctx.textAlign = 'center';
                ctx.fillStyle = '#0f172a';
                ctx.font = 'bold 60px "Noto Sans KR", serif';
                ctx.fillText('ì™„  ì£¼  ì¦', canvas.width / 2, 180);

                // Medal icon
                ctx.font = '80px serif';
                ctx.fillText('ğŸ…', canvas.width / 2, 280);

                // Name
                ctx.fillStyle = '#000';
                ctx.font = 'bold 80px "Noto Sans KR", sans-serif';
                ctx.fillText(currentResult.name, canvas.width / 2, 400);

                // Details
                ctx.font = '40px "Noto Sans KR", sans-serif';
                ctx.fillStyle = '#334155';
                ctx.fillText(`ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ${currentResult.course}`, canvas.width / 2, 490);

                ctx.font = 'bold 50px "Noto Sans KR", sans-serif';
                ctx.fillStyle = '#ef4444';
                ctx.fillText(`ê¸°ë¡: ${currentResult.time}`, canvas.width / 2, 570);

                ctx.font = '36px "Noto Sans KR", sans-serif';
                ctx.fillStyle = '#64748b';
                ctx.fillText(`ì¢…í•© ìˆœìœ„: ${currentResult.rank}ìœ„`, canvas.width / 2, 640);

                // Date
                ctx.font = '30px "Noto Sans KR", sans-serif';
                ctx.fillStyle = '#94a3b8';
                ctx.fillText('2026ë…„ 3ì›” 1ì¼', canvas.width / 2, 730);

                // Org
                ctx.font = 'bold 36px "Noto Sans KR", sans-serif';
                ctx.fillStyle = '#0f172a';
                ctx.fillText('ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ì¡°ì§ìœ„ì›íšŒ', canvas.width / 2, 780);

                // Show preview
                updatePreview();
            };

            const updatePreview = () => {
                const preview = document.getElementById('certificate-preview');
                if(preview) {
                    preview.innerHTML = `<img src="${canvas.toDataURL()}" style="max-width:100%; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1);">`;
                }
            };

            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                // Draw text on image
                // Assuming the background image has space for text
                ctx.textAlign = 'center';

                // Name position adjustment required based on actual bg image
                ctx.fillStyle = '#000';
                ctx.font = 'bold 72px "Noto Sans KR", sans-serif';
                ctx.fillText(currentResult.name, canvas.width / 2, canvas.height * 0.45);

                ctx.font = '40px "Noto Sans KR", sans-serif';
                ctx.fillText(`${currentResult.course} ì™„ì£¼`, canvas.width / 2, canvas.height * 0.55);
                ctx.fillText(`ê¸°ë¡: ${currentResult.time}`, canvas.width / 2, canvas.height * 0.62);

                updatePreview();
            };

            img.onerror = drawFallback;

            // Try loading custom bg, if fail, fallback
            img.src = 'assets/certificate_bg.png';
        }

        function downloadCertificate() {
            if (!currentResult) return;

            const canvas = document.getElementById('certificate-canvas');
            const link = document.createElement('a');
            link.download = `ì™„ì£¼ì¦_${currentResult.name}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>