<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ê°ˆë§·ê¸¸ 100M | ê²°ê³¼ì¡°íšŒ</title>
    <meta name="description" content="ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ê²°ê³¼ ì¡°íšŒ ë° ì™„ì£¼ì¦ ë°œê¸‰">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-desktop glass">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/main_logo.png" alt="ê°ˆë§·ê¸¸ 100M" onerror="this.style.display='none'">
                <span class="gradient-text">ê°ˆë§·ê¸¸ 100M</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="course.html">ì½”ìŠ¤</a></li>
                <li><a href="schedule.html">ì¼ì •</a></li>
                <li><a href="registration.html">ì°¸ê°€ì‹ ì²­</a></li>
                <li><a href="notices.html">ê³µì§€ì‚¬í•­</a></li>
                <li><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="results.html">ê²°ê³¼ì¡°íšŒ</a></li>
            </ul>
            <button class="nav-hamburger">â˜°</button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <a href="index.html">ğŸ  í™ˆ</a>
        <a href="course.html">ğŸ—ºï¸ ì½”ìŠ¤</a>
        <a href="schedule.html">ğŸ“… ì¼ì •</a>
        <a href="registration.html">ğŸ“ ì°¸ê°€ì‹ ì²­</a>
        <a href="notices.html">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
        <a href="community.html">ğŸ‘¥ ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="results.html">ğŸ† ê²°ê³¼ì¡°íšŒ</a>
    </div>

    <!-- Cheer Marquee -->
    <div class="cheer-marquee">
        <div class="cheer-marquee-inner marquee"></div>
    </div>

    <!-- Main Content -->
    <main style="padding-top:120px; min-height:100vh;">
        <section style="max-width:800px; margin:0 auto; padding:40px 24px;">
            <h1 style="font-size:2.5rem; text-align:center; margin-bottom:48px;" class="gradient-text">ê²°ê³¼ ì¡°íšŒ / ì™„ì£¼ì¦</h1>

            <!-- Search Form -->
            <div class="glass-card" style="padding:24px; margin-bottom:32px;">
                <h2 style="font-size:1.25rem; margin-bottom:24px;">ğŸ† ê¸°ë¡ ê²€ìƒ‰</h2>
                <form id="search-form" style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">
                    <div style="flex:1; min-width:150px;">
                        <label
                            style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì´ë¦„</label>
                        <input type="text" id="search-name" required class="form-input" placeholder="í™ê¸¸ë™">
                    </div>
                    <div style="width:120px;">
                        <label style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">íœ´ëŒ€í°
                            ë’·ìë¦¬</label>
                        <input type="text" id="search-phone" required maxlength="4" class="form-input"
                            placeholder="0000">
                    </div>
                    <button type="submit" class="btn-primary" style="height:52px;">ê²€ìƒ‰</button>
                </form>
                <p style="font-size:0.75rem; color:var(--slate-400); margin-top:12px;">
                    ğŸ’¡ í…ŒìŠ¤íŠ¸: ì´ë¦„ "ê¹€ì² ìˆ˜", ë’·ìë¦¬ "1234"
                </p>
            </div>

            <!-- Result Display -->
            <div id="result-container" style="display:none;">
                <!-- Filled by JS -->
            </div>

            <!-- Certificate Canvas (Hidden) -->
            <canvas id="certificate-canvas" style="display:none;"></canvas>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div style="font-weight:700; color:#fff; margin-bottom:8px;">ë¶€ì‚° ê°ˆë§·ê¸¸ 100M</div>
        <div style="font-size:0.875rem;">Â© 2026 Busan Galmaetgil 100M. All rights reserved.</div>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <a href="index.html"><span class="icon">ğŸ </span>í™ˆ</a>
            <a href="course.html"><span class="icon">ğŸ—ºï¸</span>ì½”ìŠ¤</a>
            <a href="schedule.html"><span class="icon">ğŸ“…</span>ì¼ì •</a>
            <a href="registration.html"><span class="icon">ğŸ“</span>ì‹ ì²­</a>
            <a href="results.html"><span class="icon">ğŸ†</span>ê²°ê³¼</a>
        </div>
    </nav>

    <!-- SOS Button -->
    <button class="location-share-btn">â—</button>

    <script src="js/app.js"></script>
    <script>
        let currentResult = null;

        document.getElementById('search-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('search-name').value;
            const phone4 = document.getElementById('search-phone').value;
            const container = document.getElementById('result-container');

            container.style.display = 'block';
            container.innerHTML = '<p style="text-align:center; color:var(--slate-400);">ê²€ìƒ‰ ì¤‘...</p>';

            const result = await searchResult(name, phone4);
            currentResult = result;

            if (result) {
                container.innerHTML = `
                    <div class="glass-card fade-in" style="padding:32px; text-align:center;">
                        <div style="font-size:4rem; margin-bottom:16px;">ğŸ‰</div>
                        <h2 style="font-size:1.75rem; margin-bottom:8px;">${result.name}ë‹˜ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
                        <p style="color:var(--slate-400); margin-bottom:24px;">
                            ${result.course} ì™„ì£¼ | ê¸°ë¡ ${result.time} | ${result.rank}ìœ„
                        </p>
                        
                        <div id="certificate-preview" style="margin-bottom:24px;">
                            <!-- Certificate will be rendered here -->
                        </div>
                        
                        <button onclick="downloadCertificate()" class="btn-primary btn-green" style="width:100%;">
                            ğŸ“¥ ì™„ì£¼ì¦ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                `;
                generateCertificate();
            } else {
                container.innerHTML = `
                    <div class="glass-card fade-in" style="padding:32px; text-align:center;">
                        <div style="font-size:4rem; margin-bottom:16px;">ğŸ˜¢</div>
                        <h2 style="font-size:1.25rem; margin-bottom:8px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
                        <p style="color:var(--slate-400);">ì´ë¦„ê³¼ íœ´ëŒ€í° ë’·ìë¦¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        });

        function generateCertificate() {
            if (!currentResult) return;

            const canvas = document.getElementById('certificate-canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                // Draw text
                ctx.textAlign = 'center';
                ctx.fillStyle = '#1e3a5f';

                // Title
                ctx.font = 'bold 48px Noto Sans KR, sans-serif';
                ctx.fillText('ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ì™„ì£¼ì¦', canvas.width / 2, canvas.height * 0.18);
                ctx.font = '28px Noto Sans KR, sans-serif';
                ctx.fillStyle = '#ef4444';
                ctx.fillText('3.1ì ˆ íŠ¹ë³„ ì´ë²¤íŠ¸', canvas.width / 2, canvas.height * 0.25);

                // Name
                ctx.fillStyle = '#1e3a5f';
                ctx.font = 'bold 72px Noto Sans KR, sans-serif';
                ctx.fillText(currentResult.name, canvas.width / 2, canvas.height * 0.45);

                // Course & Time
                ctx.font = '40px Noto Sans KR, sans-serif';
                ctx.fillText(`${currentResult.course} ì™„ì£¼`, canvas.width / 2, canvas.height * 0.55);
                ctx.fillText(`ê¸°ë¡: ${currentResult.time}`, canvas.width / 2, canvas.height * 0.62);
                ctx.fillText(`ìˆœìœ„: ${currentResult.rank}ìœ„`, canvas.width / 2, canvas.height * 0.69);

                // Show preview
                const preview = document.getElementById('certificate-preview');
                preview.innerHTML = `<img src="${canvas.toDataURL()}" style="max-width:100%; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.5);">`;
            };

            img.onerror = () => {
                // If certificate_bg.png not found, create a simple one
                canvas.width = 1200;
                canvas.height = 850;

                // Background gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#f0f9ff');
                gradient.addColorStop(1, '#e0f2fe');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Border
                ctx.strokeStyle = '#0369a1';
                ctx.lineWidth = 8;
                ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

                // Title
                ctx.textAlign = 'center';
                ctx.fillStyle = '#0369a1';
                ctx.font = 'bold 48px serif';
                ctx.fillText('ì™„ ì£¼ ì¦', canvas.width / 2, 120);

                // Medal icon
                ctx.font = '100px serif';
                ctx.fillText('ğŸ…', canvas.width / 2, 220);

                // Name
                ctx.fillStyle = '#1e3a5f';
                ctx.font = 'bold 72px sans-serif';
                ctx.fillText(currentResult.name, canvas.width / 2, 340);

                // Details
                ctx.font = '36px sans-serif';
                ctx.fillStyle = '#475569';
                ctx.fillText(`ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ${currentResult.course}`, canvas.width / 2, 420);
                ctx.fillText(`ê¸°ë¡: ${currentResult.time}`, canvas.width / 2, 480);
                ctx.fillText(`ìˆœìœ„: ${currentResult.rank}ìœ„`, canvas.width / 2, 540);

                // Date
                ctx.font = '28px sans-serif';
                ctx.fillText('2026ë…„ 3ì›” 1ì¼', canvas.width / 2, 620);

                // Org
                ctx.fillText('ë¶€ì‚°íŠ¸ë ˆì¼ëŸ¬ë‹í˜‘íšŒ', canvas.width / 2, 680);

                // Show preview
                const preview = document.getElementById('certificate-preview');
                preview.innerHTML = `<img src="${canvas.toDataURL()}" style="max-width:100%; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.5);">`;
            };

            img.src = 'assets/certificate_bg.png';
        }

        function downloadCertificate() {
            if (!currentResult) return;

            const canvas = document.getElementById('certificate-canvas');
            const link = document.createElement('a');
            link.download = `ì™„ì£¼ì¦_${currentResult.name}_${currentResult.course}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>

</html>