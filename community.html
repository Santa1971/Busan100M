<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ê°ˆë§·ê¸¸ 100M | ììœ ê²Œì‹œíŒ</title>
    <meta name="description" content="ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ììœ ê²Œì‹œíŒ - ëŸ¬ë„ˆë“¤ì˜ ì†Œí†µ ê³µê°„">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-desktop glass">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/main_logo.png" alt="ê°ˆë§·ê¸¸ 100M" onerror="this.style.display='none'">
                <span class="gradient-text">ê°ˆë§·ê¸¸ 100M</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="course.html">ì½”ìŠ¤</a></li>
                <li><a href="schedule.html">ì¼ì •</a></li>
                <li><a href="registration.html">ì°¸ê°€ì‹ ì²­</a></li>
                <li><a href="notices.html">ê³µì§€ì‚¬í•­</a></li>
                <li><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="results.html">ê²°ê³¼ì¡°íšŒ</a></li>
            </ul>
            <button class="nav-hamburger">â˜°</button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <a href="index.html">ğŸ  í™ˆ</a>
        <a href="course.html">ğŸ—ºï¸ ì½”ìŠ¤</a>
        <a href="schedule.html">ğŸ“… ì¼ì •</a>
        <a href="registration.html">ğŸ“ ì°¸ê°€ì‹ ì²­</a>
        <a href="notices.html">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
        <a href="community.html">ğŸ‘¥ ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="results.html">ğŸ† ê²°ê³¼ì¡°íšŒ</a>
    </div>

    <!-- Cheer Marquee -->
    <div class="cheer-marquee">
        <div class="cheer-marquee-inner marquee"></div>
    </div>

    <!-- Main Content -->
    <main style="padding-top:120px; min-height:100vh;">
        <section style="max-width:900px; margin:0 auto; padding:40px 24px;">
            <h1 style="font-size:2.5rem; text-align:center; margin-bottom:16px;" class="gradient-text">ììœ ê²Œì‹œíŒ</h1>
            <p style="text-align:center; color:var(--slate-400); margin-bottom:48px;">ëŸ¬ë„ˆë“¤ì˜ ììœ ë¡œìš´ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”!</p>

            <!-- Post Form Toggle -->
            <div style="text-align:right; margin-bottom:20px;">
                <button onclick="showPostForm()" class="btn-primary" style="padding:12px 24px;">âœï¸ ê¸€ì“°ê¸°</button>
            </div>

            <!-- Post Form (Hidden by default) -->
            <div id="post-form" class="glass-card" style="padding:24px; display:none; margin-bottom:32px;">
                <h2 style="font-size:1.25rem; margin-bottom:24px;">âœï¸ ìƒˆ ê¸€ ì‘ì„±</h2>
                <form onsubmit="submitPost(event)" style="display:flex; flex-direction:column; gap:16px;">
                    <div>
                        <label
                            style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ë‹‰ë„¤ì„</label>
                        <input type="text" name="nickname" required class="form-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                            maxlength="20">
                    </div>
                    <div>
                        <label
                            style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì œëª©</label>
                        <input type="text" name="title" required class="form-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                            maxlength="100">
                    </div>
                    <div>
                        <label
                            style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ë‚´ìš©</label>
                        <textarea name="content" required class="form-input" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="6"
                            style="resize:vertical;"></textarea>
                    </div>
                    <div>
                        <label style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì‚­ì œ
                            ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" name="password" required class="form-input" placeholder="ê¸€ ì‚­ì œ ì‹œ í•„ìš”"
                            maxlength="20">
                    </div>
                    <div style="display:flex; gap:12px;">
                        <button type="button" onclick="hidePostForm()" class="btn-secondary" style="flex:1;">ì·¨ì†Œ</button>
                        <button type="submit" class="btn-primary" style="flex:1;">ë“±ë¡í•˜ê¸°</button>
                    </div>
                </form>
            </div>

            <!-- Posts List -->
            <div class="glass-card" style="padding:24px;">
                <h2 style="font-size:1.25rem; margin-bottom:24px;">ğŸ“ ê²Œì‹œê¸€ ëª©ë¡</h2>
                <div id="posts-list" style="display:flex; flex-direction:column; gap:12px;">
                    <!-- Filled by JS -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div style="font-weight:700; color:#fff; margin-bottom:8px;">ë¶€ì‚° ê°ˆë§·ê¸¸ 100M</div>
        <div style="font-size:0.875rem;">Â© 2026 Busan Galmaetgil 100M. All rights reserved.</div>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <a href="index.html"><span class="icon">ğŸ </span>í™ˆ</a>
            <a href="course.html"><span class="icon">ğŸ—ºï¸</span>ì½”ìŠ¤</a>
            <a href="schedule.html"><span class="icon">ğŸ“…</span>ì¼ì •</a>
            <a href="registration.html"><span class="icon">ğŸ“</span>ì‹ ì²­</a>
            <a href="results.html"><span class="icon">ğŸ†</span>ê²°ê³¼</a>
        </div>
    </nav>

    <!-- SOS Button -->
    <button class="location-share-btn">â—</button>

    <script src="js/app.js"></script>
    <script>
        let postsData = [];

        document.addEventListener('DOMContentLoaded', async () => {
            await loadPosts();
        });

        async function loadPosts() {
            const list = document.getElementById('posts-list');
            list.innerHTML = '<p style="text-align:center; color:var(--slate-400);">ë¡œë”© ì¤‘...</p>';

            try {
                const posts = await fetchData('getPosts');
                postsData = posts || [];
                renderPosts(postsData);
            } catch (err) {
                list.innerHTML = '<p style="text-align:center; color:var(--slate-400);">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        function renderPosts(posts) {
            const list = document.getElementById('posts-list');
            if (!posts || posts.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:var(--slate-400);">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = posts.map(post => `
                <div style="padding:16px; background:var(--slate-800); border-radius:12px; cursor:pointer; transition:all 0.2s;"
                     onmouseover="this.style.background='var(--slate-700)'" 
                     onmouseout="this.style.background='var(--slate-800)'"
                     onclick="viewPost(${post.id})">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap;">
                        <div style="flex:1; min-width:200px;">
                            <h3 style="font-size:1rem; font-weight:600; margin-bottom:8px; color:#fff;">${post.title}</h3>
                            <div style="font-size:0.75rem; color:var(--slate-400);">
                                <span style="color:var(--neon-blue);">${post.nickname}</span> Â· ${post.date} Â· ì¡°íšŒ ${post.views || 0}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showPostForm() {
            document.getElementById('post-form').style.display = 'block';
            document.getElementById('post-form').scrollIntoView({ behavior: 'smooth' });
        }

        function hidePostForm() {
            document.getElementById('post-form').style.display = 'none';
        }

        async function submitPost(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const post = {
                nickname: formData.get('nickname'),
                title: formData.get('title'),
                content: formData.get('content'),
                password: formData.get('password')
            };

            try {
                const params = new URLSearchParams(post);
                const response = await fetch(`${API_URL}?action=submitPost&${params.toString()}`, {
                    method: 'POST'
                });
                const result = await response.json();

                if (result.success) {
                    alert('âœ… ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    hidePostForm();
                    e.target.reset();
                    await loadPosts();  // Reload posts
                } else {
                    alert('âŒ ì˜¤ë¥˜: ' + (result.error || 'ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                }
            } catch (err) {
                alert('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Post submit error:', err);
            }
        }

        function viewPost(id) {
            const post = postsData.find(p => p.id === id);
            if (post) {
                alert(`ğŸ“ ${post.title}\n\n${post.content}\n\n- ${post.nickname} (${post.date})`);
            }
        }
    </script>
</body>

</html>