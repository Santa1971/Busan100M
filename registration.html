<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° ê°ˆë§·ê¸¸ 100M | ì°¸ê°€ì‹ ì²­</title>
    <meta name="description" content="ë¶€ì‚° ê°ˆë§·ê¸¸ 100M ì°¸ê°€ ì‹ ì²­ ë° í˜„í™© ì¡°íšŒ">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Daum ìš°í¸ë²ˆí˜¸ API -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-desktop glass">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/main_logo.png" alt="ê°ˆë§·ê¸¸ 100M" onerror="this.style.display='none'">
                <span class="gradient-text">ê°ˆë§·ê¸¸ 100M</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">í™ˆ</a></li>
                <li><a href="course.html">ì½”ìŠ¤</a></li>
                <li><a href="schedule.html">ì¼ì •</a></li>
                <li><a href="registration.html">ì°¸ê°€ì‹ ì²­</a></li>
                <li><a href="notices.html">ê³µì§€ì‚¬í•­</a></li>
                <li><a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
                <li><a href="results.html">ê²°ê³¼ì¡°íšŒ</a></li>
            </ul>
            <button class="nav-hamburger">â˜°</button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <a href="index.html">ğŸ  í™ˆ</a>
        <a href="course.html">ğŸ—ºï¸ ì½”ìŠ¤</a>
        <a href="schedule.html">ğŸ“… ì¼ì •</a>
        <a href="registration.html">ğŸ“ ì°¸ê°€ì‹ ì²­</a>
        <a href="notices.html">ğŸ“¢ ê³µì§€ì‚¬í•­</a>
        <a href="community.html">ğŸ‘¥ ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="results.html">ğŸ† ê²°ê³¼ì¡°íšŒ</a>
    </div>

    <!-- Cheer Marquee -->
    <div class="cheer-marquee">
        <div class="cheer-marquee-inner marquee"></div>
    </div>

    <!-- Main Content -->
    <main style="padding-top:120px; min-height:100vh;">
        <section style="max-width:600px; margin:0 auto; padding:40px 24px;">
            <h1 style="font-size:2.5rem; text-align:center; margin-bottom:48px;" class="gradient-text">ì°¸ê°€ ì‹ ì²­</h1>

            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="register"
                    style="flex:1; min-width:140px; padding:24px 16px; background:linear-gradient(135deg, #1e293b, #334155); border:2px solid var(--neon-red); border-radius:16px; cursor:pointer; transition:all 0.3s;">
                    <div style="font-size:3rem; margin-bottom:12px;">ğŸ“</div>
                    <div style="font-weight:700; font-size:1.125rem; color:#fff;">ì‹ ì²­ì„œ ì‘ì„±</div>
                    <div style="font-size:0.875rem; color:var(--slate-400); margin-top:4px;">í¼ìœ¼ë¡œ ì‹ ì²­í•˜ê¸°</div>
                </button>
                <button class="tab-btn" data-tab="kakao"
                    style="flex:1; min-width:140px; padding:24px 16px; background:linear-gradient(135deg, #fee500, #ffd700); border:2px solid #fee500; border-radius:16px; cursor:pointer; transition:all 0.3s;">
                    <div style="font-size:3rem; margin-bottom:12px;">ğŸ’¬</div>
                    <div style="font-weight:700; font-size:1.125rem; color:#3c1e1e;">ì¹´ì¹´ì˜¤í†¡ ì‹ ì²­</div>
                    <div style="font-size:0.875rem; color:#5c3c3c; margin-top:4px;">ì˜¤í”ˆì±„íŒ…ë°© ì°¸ì—¬</div>
                </button>
                <button class="tab-btn" data-tab="status"
                    style="flex:1; min-width:140px; padding:24px 16px; background:linear-gradient(135deg, #1e293b, #334155); border:2px solid transparent; border-radius:16px; cursor:pointer; transition:all 0.3s;">
                    <div style="font-size:3rem; margin-bottom:12px;">ğŸ”</div>
                    <div style="font-weight:700; font-size:1.125rem; color:#fff;">ì‹ ì²­í˜„í™© ì¡°íšŒ</div>
                    <div style="font-size:0.875rem; color:var(--slate-400); margin-top:4px;">ê¸°ì¡´ ì‹ ì²­ í™•ì¸</div>
                </button>
            </div>

            <!-- Tab Content: KakaoTalk -->
            <div id="tab-kakao" class="tab-content" style="display:none;">
                <div class="glass-card" style="padding:32px; text-align:center;">
                    <h2 style="font-size:1.25rem; margin-bottom:24px;">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì‹ ì²­í•˜ê¸°</h2>
                    <p style="color:var(--slate-400); margin-bottom:24px;">
                        ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ì— ì°¸ì—¬í•˜ì„¸ìš”.<br>
                        ì±„íŒ…ë°©ì—ì„œ ì°¸ê°€ ì‹ ì²­ ì•ˆë‚´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <a id="kakao-link" href="#" target="_blank"
                        style="display:inline-block; padding:16px 48px; background:#fee500; color:#3c1e1e; font-weight:700; font-size:1.125rem; border-radius:12px; text-decoration:none; transition:all 0.3s;">
                        ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°© ì°¸ì—¬í•˜ê¸°
                    </a>
                    <p style="color:var(--slate-500); font-size:0.875rem; margin-top:16px;">
                        â€» ì¹´ì¹´ì˜¤í†¡ ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤
                    </p>
                </div>
            </div>

            <!-- Tab Content: Registration Form -->
            <div id="tab-register" class="tab-content">
                <div class="glass-card" style="padding:32px;">
                    <h2 style="font-size:1.25rem; margin-bottom:24px; text-align:center;">ğŸ“ ì‹ ì²­ì„œ ì‘ì„±</h2>
                    <form id="registration-form" style="display:flex; flex-direction:column; gap:16px;">
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì´ë¦„
                                *</label>
                            <input type="text" name="name" required class="form-input" placeholder="í™ê¸¸ë™">
                        </div>
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ìƒë…„ì›”ì¼
                                *</label>
                            <input type="date" name="birth" required class="form-input">
                        </div>
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì—°ë½ì²˜
                                *</label>
                            <input type="tel" name="phone" required class="form-input" placeholder="010-0000-0000">
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                            <div>
                                <label
                                    style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì½”ìŠ¤
                                    *</label>
                                <select name="course" required class="form-input">
                                    <option value="100M">100M</option>
                                    <option value="50M">50M</option>
                                </select>
                            </div>
                            <div>
                                <label
                                    style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">í˜ˆì•¡í˜•</label>
                                <select name="bloodType" class="form-input">
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                            </div>
                        </div>

                        <!-- ë¹„ìƒì—°ë½ì²˜ -->
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ë¹„ìƒì—°ë½ì²˜
                                ì´ë¦„</label>
                            <input type="text" name="emergencyContact" class="form-input" placeholder="ê¹€ë¶€ëª¨">
                        </div>
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ë¹„ìƒì—°ë½ì²˜
                                ë²ˆí˜¸</label>
                            <input type="tel" name="emergencyPhone" class="form-input" placeholder="010-0000-0000">
                        </div>

                        <!-- ì£¼ì†Œ ì…ë ¥ (ì„ íƒì‚¬í•­) -->
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì£¼ì†Œ
                                (ì„ íƒ)</label>
                            <div style="display:flex; gap:8px; margin-bottom:8px;">
                                <input type="text" name="postcode" id="postcode" class="form-input" placeholder="ìš°í¸ë²ˆí˜¸"
                                    readonly style="flex:1;">
                                <button type="button" onclick="searchPostcode()" class="btn-primary"
                                    style="padding:12px 16px; white-space:nowrap;">ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰</button>
                            </div>
                            <input type="text" name="address" id="address" class="form-input" placeholder="ê¸°ë³¸ì£¼ì†Œ"
                                readonly style="margin-bottom:8px;">
                            <input type="text" name="addressDetail" class="form-input" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥">
                        </div>

                        <!-- ê¸°ë…í‹° ì‚¬ì´ì¦ˆ (ì„ íƒì‚¬í•­) -->
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ê¸°ë…í‹°
                                ì‚¬ì´ì¦ˆ (ì„ íƒ)</label>
                            <select name="tshirtSize" class="form-input">
                                <option value="">ì„ íƒì•ˆí•¨</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                        </div>

                        <button type="submit" class="btn-primary" style="margin-top:8px; width:100%;">
                            ì‹ ì²­í•˜ê¸°
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tab Content: Status Check -->
            <div id="tab-status" class="tab-content" style="display:none;">
                <div class="glass-card" style="padding:32px;">
                    <h2 style="font-size:1.25rem; margin-bottom:24px; text-align:center;">ğŸ” ì‹ ì²­ í˜„í™© ì¡°íšŒ</h2>
                    <form id="status-form" style="display:flex; flex-direction:column; gap:16px;">
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">ì´ë¦„</label>
                            <input type="text" id="status-name" required class="form-input" placeholder="í™ê¸¸ë™">
                        </div>
                        <div>
                            <label
                                style="display:block; font-size:0.875rem; color:var(--slate-400); margin-bottom:8px;">íœ´ëŒ€í°
                                ë’·ìë¦¬ 4ê°œ</label>
                            <input type="text" id="status-phone" required maxlength="4" class="form-input"
                                placeholder="0000">
                        </div>
                        <button type="submit" class="btn-primary btn-blue" style="width:100%;">
                            ì¡°íšŒí•˜ê¸°
                        </button>
                    </form>

                    <div id="status-result" style="margin-top:24px;"></div>

                    <div style="margin-top:32px; padding:16px; background:var(--slate-800); border-radius:12px;">
                        <p style="font-size:0.875rem; color:var(--slate-400);">
                            ğŸ’¡ <strong>í…ŒìŠ¤íŠ¸ ì¡°íšŒ:</strong><br>
                            ì´ë¦„: ê¹€ì² ìˆ˜ / ë’·ìë¦¬: 1234
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div style="font-weight:700; color:#fff; margin-bottom:8px;">ë¶€ì‚° ê°ˆë§·ê¸¸ 100M</div>
        <div style="font-size:0.875rem;">Â© 2026 Busan Galmaetgil 100M. All rights reserved.</div>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <a href="index.html"><span class="icon">ğŸ </span>í™ˆ</a>
            <a href="course.html"><span class="icon">ğŸ—ºï¸</span>ì½”ìŠ¤</a>
            <a href="schedule.html"><span class="icon">ğŸ“…</span>ì¼ì •</a>
            <a href="registration.html"><span class="icon">ğŸ“</span>ì‹ ì²­</a>
            <a href="results.html"><span class="icon">ğŸ†</span>ê²°ê³¼</a>
        </div>
    </nav>

    <!-- SOS Button -->
    <button class="location-share-btn">â—</button>

    <script src="js/app.js"></script>
    <script>
        // ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰
        function searchPostcode() {
            new daum.Postcode({
                oncomplete: function (data) {
                    document.getElementById('postcode').value = data.zonecode;
                    document.getElementById('address').value = data.roadAddress || data.jibunAddress;
                }
            }).open();
        }

        // ì¹´ì¹´ì˜¤í†¡ ë§í¬ ë¡œë“œ (Configì—ì„œ)
        (async function loadKakaoLink() {
            const config = await fetchData('getConfig');
            if (config && config.kakaoLink) {
                document.getElementById('kakao-link').href = config.kakaoLink;
            } else {
                // Mock ëª¨ë“œìš© ê¸°ë³¸ ë§í¬
                document.getElementById('kakao-link').href = 'https://open.kakao.com/o/go8xJLai';
            }
        })();

        // Tab Switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active button
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                    b.style.borderColor = 'transparent';
                    // ì¹´ì¹´ì˜¤í†¡ íƒ­ì€ ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ë¡œ
                    if (b.dataset.tab === 'kakao') {
                        b.style.borderColor = '#fee500';
                    }
                });
                btn.classList.add('active');
                if (btn.dataset.tab === 'kakao') {
                    btn.style.borderColor = '#fee500';
                } else {
                    btn.style.borderColor = 'var(--neon-red)';
                }

                // Show corresponding tab content
                const tabId = btn.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById('tab-' + tabId).style.display = 'block';
            });
        });

        // Registration Form
        document.getElementById('registration-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            if (USE_MOCK) {
                alert('ğŸ‰ ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n(Mock ëª¨ë“œ - ì‹¤ì œ ë°ì´í„°ëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)');
                e.target.reset();
            } else {
                try {
                    const params = new URLSearchParams(data);
                    const response = await fetch(`${API_URL}?action=register&${params.toString()}`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    if (result.success) {
                        alert('ğŸ‰ ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' + result.message);
                        e.target.reset();
                    } else {
                        alert('âŒ ì‹ ì²­ ì˜¤ë¥˜: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                } catch (err) {
                    alert('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    console.error('Registration error:', err);
                }
            }
        });

        // Status Check Form
        let currentStatusInfo = null;

        document.getElementById('status-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('status-name').value;
            const phone4 = document.getElementById('status-phone').value;
            const resultDiv = document.getElementById('status-result');

            resultDiv.innerHTML = '<p style="text-align:center; color:var(--slate-400);">ì¡°íšŒ ì¤‘...</p>';

            const result = await checkRegistrationStatus(name, phone4);
            currentStatusInfo = result;

            if (result.found) {
                // ìƒíƒœë³„ ìƒ‰ìƒ
                let statusColor = 'var(--green-500)';
                let statusBg = 'rgba(34, 197, 94, 0.1)';
                let statusIcon = 'âœ…';

                if (result.status === 'ì·¨ì†Œ') {
                    statusColor = 'var(--slate-400)';
                    statusBg = 'rgba(100, 116, 139, 0.1)';
                    statusIcon = 'â›”';
                } else if (result.status === 'ìŠ¹ì¸ì™„ë£Œ' || result.status === 'ìŠ¹ì¸') {
                    statusColor = 'var(--neon-blue)';
                    statusBg = 'rgba(59, 130, 246, 0.1)';
                    statusIcon = 'ğŸ‰';
                } else if (result.status === 'ëŒ€ê¸°' || result.status === 'ì‹¬ì‚¬ì¤‘') {
                    statusColor = '#f59e0b';
                    statusBg = 'rgba(245, 158, 11, 0.1)';
                    statusIcon = 'â³';
                }

                resultDiv.innerHTML = `
                    <div style="padding:20px; background:${statusBg}; border:1px solid ${statusColor}; border-radius:12px;">
                        <div style="font-weight:700; color:${statusColor}; margin-bottom:12px;">${statusIcon} ì‹ ì²­ í™•ì¸ë¨</div>
                        <div style="display:grid; gap:8px; margin-bottom:16px;">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="color:var(--slate-400);">ì½”ìŠ¤</span>
                                <span style="font-weight:600;">${result.course}</span>
                            </div>
                            <div style="display:flex; justify-content:space-between;">
                                <span style="color:var(--slate-400);">ìƒíƒœ</span>
                                <span style="font-weight:600; color:${statusColor};">${result.status}</span>
                            </div>
                        </div>
                        ${result.status !== 'ì·¨ì†Œ' ? `
                            <button onclick="cancelRegistrationAction()" 
                                    style="width:100%; padding:12px; background:rgba(239, 68, 68, 0.2); border:1px solid var(--neon-red); border-radius:8px; color:var(--neon-red); cursor:pointer; font-weight:600;">
                                âŒ ì‹ ì²­ ì·¨ì†Œí•˜ê¸°
                            </button>
                        ` : '<p style="text-align:center; color:var(--slate-400); font-size:0.875rem;">ì´ë¯¸ ì·¨ì†Œëœ ì‹ ì²­ì…ë‹ˆë‹¤.</p>'}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div style="padding:20px; background:rgba(239, 68, 68, 0.1); border:1px solid var(--neon-red); border-radius:12px;">
                        <div style="font-weight:700; color:var(--neon-red);">âŒ ì‹ ì²­ ë‚´ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                        <p style="font-size:0.875rem; color:var(--slate-400); margin-top:8px;">ì´ë¦„ê³¼ íœ´ëŒ€í° ë’·ìë¦¬ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            }
        });

        async function cancelRegistrationAction() {
            const name = document.getElementById('status-name').value;
            const phone4 = document.getElementById('status-phone').value;

            if (!confirm('ì •ë§ ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì·¨ì†Œ í›„ì—ëŠ” ë‹¤ì‹œ ì‹ ì²­í•´ì•¼ í•©ë‹ˆë‹¤.')) {
                return;
            }

            try {
                const params = new URLSearchParams({ name, phone4 });
                const response = await fetch(`${API_URL}?action=cancelRegistration&${params.toString()}`, { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    alert('âœ… ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('status-form').dispatchEvent(new Event('submit'));
                } else {
                    alert('âŒ ì·¨ì†Œ ì˜¤ë¥˜: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (err) {
                alert('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>

</html>